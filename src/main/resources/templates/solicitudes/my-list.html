<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/main :: layout(~{::section})}">
<head></head>
<body>
<section>

  <div class="d-flex align-items-center mb-4">
    <a href="/" class="btn btn-light rounded-circle me-3 border shadow-sm"><i class="bi bi-arrow-left"></i></a>
    <div>
      <h4 class="fw-bold m-0">Mis Solicitudes</h4>
      <p class="text-muted small m-0" th:text="${docente.nombre} + ' ' + ${docente.apellidos}">Nombre Docente</p>
    </div>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-md-6">
      <div class="card bg-primary text-white border-0 shadow-sm h-100"
           style="background: linear-gradient(135deg, #4f46e5 0%, #3730a3 100%);">
        <div class="card-body d-flex justify-content-between align-items-center p-4">
          <div>
            <h6 class="text-uppercase small opacity-75 fw-bold mb-1">Pendientes de Disfrutar</h6>
            <h1 class="mb-0 fw-bold display-5" th:text="${statsPendientes}">0</h1>
            <small class="opacity-75"><i class="bi bi-check-circle-fill me-1"></i> Aprobados y fecha futura</small>
          </div>
          <div class="p-3 bg-white bg-opacity-10 rounded-circle">
            <i class="bi bi-calendar-event fs-1"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card bg-white border-0 shadow-sm h-100">
        <div class="card-body d-flex justify-content-between align-items-center p-4">
          <div>
            <h6 class="text-uppercase text-muted small fw-bold mb-1">Días ya Disfrutados</h6>
            <h1 class="mb-0 fw-bold text-dark display-5" th:text="${statsGastados}">0</h1>
            <small class="text-muted">Histórico acumulado</small>
          </div>
          <div class="p-3 bg-light rounded-circle text-muted">
            <i class="bi bi-clock-history fs-1"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div th:if="${param.uploadSuccess}" class="alert alert-success border-0 shadow-sm d-flex align-items-center mb-4">
    <i class="bi bi-check-circle-fill fs-4 me-3"></i>
    <div>Material subido correctamente.</div>
  </div>

  <div class="card border-0 shadow-sm">
    <div class="card-header bg-white py-3">
      <h6 class="m-0 fw-bold text-muted text-uppercase small">Historial de Peticiones</h6>
    </div>
    <div class="table-responsive">
      <table class="table align-middle mb-0 table-hover">
        <thead class="bg-light">
        <tr>
          <th class="ps-4 py-3">Fecha Solicitada</th>
          <th class="py-3">Motivo</th>
          <th class="py-3">Estado</th>
          <th class="py-3">Gestión / Material</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="asunto : ${misAsuntos}">
          <td class="ps-4 fw-bold text-dark">
            <i class="bi bi-calendar3 me-2 text-muted"></i>
            <span th:text="${asunto.diaSolicitado}">2024-01-01</span>
          </td>

          <td class="text-muted small">
            <span th:text="${asunto.descripcion != null && !asunto.descripcion.isEmpty() ? asunto.descripcion : 'Sin descripción'}"></span>
          </td>

          <td>
            <span th:if="${asunto.aprobado == null}" class="badge bg-warning-subtle text-warning border border-warning-subtle px-3 py-2 rounded-pill">Pendiente</span>
            <span th:if="${asunto.aprobado == true}" class="badge bg-success-subtle text-success border border-success-subtle px-3 py-2 rounded-pill">Aprobado</span>
            <span th:if="${asunto.aprobado == false}" class="badge bg-danger-subtle text-danger border border-danger-subtle px-3 py-2 rounded-pill">Denegado</span>
          </td>

          <td>
            <div th:if="${asunto.aprobado == true}">
              <form th:action="@{/web/solicitud/subir-material}" method="post" enctype="multipart/form-data" class="d-flex gap-2 align-items-center">
                <input type="hidden" name="idSolicitud" th:value="${asunto.id}">
                <input type="file" name="archivo" class="form-control form-control-sm" style="max-width: 200px;" required>
                <button type="submit" class="btn btn-sm btn-primary shadow-sm">
                  <i class="bi bi-cloud-upload"></i>
                </button>
              </form>
            </div>
            <div th:unless="${asunto.aprobado == true}">
              <span class="text-muted small fst-italic">-</span>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <div th:if="${#lists.isEmpty(misAsuntos)}" class="p-5 text-center text-muted">
      <i class="bi bi-inbox fs-1 d-block mb-3 opacity-25"></i>
      <p>No tienes solicitudes registradas.</p>
      <a href="/web/solicitud/nueva" class="btn btn-outline-primary btn-sm">Crear primera solicitud</a>
    </div>
  </div>

</section>
</body>
</html>